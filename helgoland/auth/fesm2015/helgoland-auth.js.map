{"version":3,"file":"helgoland-auth.js.map","sources":["ng://@helgoland/auth/lib/basic-auth/basic-auth.service.ts","ng://@helgoland/auth/lib/basic-auth/basic-auth-service-maintainer.service.ts","ng://@helgoland/auth/lib/basic-auth/basic-auth-interceptor.service.ts","ng://@helgoland/auth/lib/basic-auth/basic-auth.module.ts"],"sourcesContent":["import { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\n/**\n * Maintains all basic auth tokens and also do the authentication process.\n */\n@Injectable()\nexport class BasicAuthService {\n\n  private basicAuthTokens: Map<string, string> = new Map();\n\n  constructor(\n    private http: HttpClient\n  ) { }\n\n  /**\n   * Do the authentication.\n   */\n  public auth(username: string, password: string, url: string): Observable<string> {\n    const token = 'Basic ' + btoa(username + ':' + password);\n    const headers = new HttpHeaders({ 'Authorization': token });\n    return this.http.get(url, { headers })\n      .pipe(\n        map(res => {\n          this.basicAuthTokens.set(url, token);\n          return token;\n        })\n      );\n  }\n\n  /**\n   * Removes existing token.\n   */\n  public clearToken(url: string): void {\n    if (this.basicAuthTokens.has(url)) {\n      this.basicAuthTokens.delete(url);\n    }\n  }\n\n  /**\n   * Checks if a token exists.\n   */\n  public hasToken(url: string): boolean {\n    return this.basicAuthTokens.has(url);\n  }\n\n  /**\n   * Gets the token for the given service url.\n   */\n  public getToken(url: string): string {\n    return this.basicAuthTokens.has(url) ? this.basicAuthTokens.get(url) : null;\n  }\n\n}\n","import { Injectable } from '@angular/core';\nimport { Settings, SettingsService } from '@helgoland/core';\n\n/**\n * This service maintaines all service urls which are secured with basic auth. The service is used to check for every servie url if it is necessary to work with basic auth. It is possible to\n * register a url and it also checks every dataset url in the settings.\n */\n@Injectable()\nexport class BasicAuthServiceMaintainer {\n\n  private services: string[] = [];\n\n  constructor(\n    protected settingsService: SettingsService<Settings>\n  ) { }\n\n  /**\n   * Register an additional service url, which is secured with basic auth.\n   */\n  public registerService(url: string) {\n    if (this.services.indexOf(url) === -1) {\n      this.services.push(url);\n    }\n  }\n\n  /**\n   * Checks if a given url is registered as secured with basic auth.\n   */\n  public getCorrespondingService(url: string): string {\n    const matchedUrl = this.services.find(e => url.startsWith(e));\n    if (matchedUrl) {\n      return matchedUrl;\n    }\n    const settings = this.settingsService.getSettings();\n    if (settings && settings.datasetApis && Array.isArray(settings.datasetApis)) {\n      const api = settings.datasetApis.find((e) => url.startsWith(e.url) && e.basicAuth);\n      if (api) {\n        return api.url;\n      }\n    }\n  }\n\n}\n","import { HttpEvent, HttpRequest, HttpResponse } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { HttpRequestOptions, HttpServiceHandler, HttpServiceInterceptor, Settings, SettingsService } from '@helgoland/core';\nimport { Observable, Observer } from 'rxjs';\n\nimport { BasicAuthServiceMaintainer } from './basic-auth-service-maintainer.service';\nimport { BasicAuthService } from './basic-auth.service';\n\n/**\n * Interceptor to a basic auth token if needed.\n */\n@Injectable()\nexport class BasicAuthInterceptorService implements HttpServiceInterceptor {\n\n  constructor(\n    protected settings: SettingsService<Settings>,\n    protected basicAuthServices: BasicAuthServiceMaintainer,\n    protected basicAuthSrvc: BasicAuthService,\n    protected receptor: BasicAuthInformer\n  ) { }\n\n  intercept(req: HttpRequest<any>, options: Partial<HttpRequestOptions>, next: HttpServiceHandler): Observable<HttpEvent<any>> {\n    const url = this.basicAuthServices.getCorrespondingService(req.url);\n    if (url) {\n      if (this.basicAuthSrvc.hasToken(url)) {\n        req = req.clone({\n          setHeaders: {\n            Authorization: this.basicAuthSrvc.getToken(url)\n          }\n        });\n        return next.handle(req, options);\n      } else {\n        return new Observable<HttpEvent<any>>((observer: Observer<HttpEvent<any>>) => {\n          this.receptor.doBasicAuth(url).subscribe(successfully => {\n            if (successfully) {\n              req = req.clone({\n                setHeaders: {\n                  Authorization: this.basicAuthSrvc.getToken(url)\n                }\n              });\n            }\n            next.handle(req, options).subscribe(res => {\n              observer.next(res);\n              if (res instanceof HttpResponse) {\n                observer.complete();\n              }\n            });\n          });\n        });\n      }\n    } else {\n      return next.handle(req, options);\n    }\n  }\n}\n\nexport interface BasicAuthCredentials {\n  username: string;\n  password: string;\n}\n\n/**\n * Needs to be implemented to do the authentication for the given url.\n */\nexport abstract class BasicAuthInformer {\n  public abstract doBasicAuth(url: string): Observable<boolean>;\n}\n","import { NgModule } from '@angular/core';\nimport { HTTP_SERVICE_INTERCEPTORS } from '@helgoland/core';\n\nimport { BasicAuthServiceMaintainer } from './basic-auth-service-maintainer.service';\nimport { BasicAuthService } from './basic-auth.service';\nimport { BasicAuthInterceptorService } from './basic-auth-interceptor.service';\n\n@NgModule({\n  providers: [\n    BasicAuthService,\n    BasicAuthServiceMaintainer,\n    {\n      provide: HTTP_SERVICE_INTERCEPTORS,\n      useClass: BasicAuthInterceptorService,\n      multi: true\n    }\n  ]\n})\nexport class HelgolandBasicAuthModule { }\n"],"names":[],"mappings":"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"}
