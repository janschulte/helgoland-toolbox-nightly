{"version":3,"file":"helgoland-favorite.js.map","sources":["ng://@helgoland/favorite/lib/service/favorite.service.ts","ng://@helgoland/favorite/lib/favorite-toggler/favorite-toggler.component.ts","ng://@helgoland/favorite/lib/service/json-favorite-exporter.service.ts","ng://@helgoland/favorite/lib/favorite.module.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { IDataset, LocalStorage } from '@helgoland/core';\n\nconst CACHE_PARAM_FAVORITES_SINGLE = 'SingleFavorites';\nconst CACHE_PARAM_FAVORITES_GROUP = 'GroupFavorites';\n\n@Injectable()\nexport class FavoriteService {\n\n  private singleFavs: Map<string, SingleFavorite>;\n  private groupFavs: Map<string, GroupFavorite>;\n  private groupCounter = 0;\n\n  constructor(\n    protected localStorage: LocalStorage\n  ) {\n    this.loadFavorites();\n  }\n\n  public addFavorite(dataset: IDataset, label?: string): boolean {\n    if (!this.singleFavs.has(dataset.internalId)) {\n      this.singleFavs.set(dataset.internalId, {\n        id: dataset.internalId,\n        label: label ? label : dataset.label,\n        favorite: dataset\n      });\n      this.saveFavorites();\n      return true;\n    }\n    return false;\n  }\n\n  public hasFavorite(dataset: IDataset): boolean {\n    return this.singleFavs.has(dataset.internalId);\n  }\n\n  public getFavorites(): SingleFavorite[] {\n    return Array.from(this.singleFavs.values());\n  }\n\n  public removeFavorite(favoriteId: string): boolean {\n    if (this.singleFavs.has(favoriteId)) {\n      this.singleFavs.delete(favoriteId);\n      this.saveFavorites();\n      return true;\n    }\n    if (this.groupFavs.has(favoriteId)) {\n      this.groupFavs.delete(favoriteId);\n      this.saveFavorites();\n      return true;\n    }\n    return false;\n  }\n\n  public addFavoriteGroup(datasets: IDataset[], label?: string): boolean {\n    const id = 'Group' + this.groupCounter++;\n    this.groupFavs.set(id, {\n      id,\n      label: label ? label : id,\n      favorites: datasets\n    });\n    this.saveFavorites();\n    return true;\n  }\n\n  public getFavoriteGroups(): GroupFavorite[] {\n    return Array.from(this.groupFavs.values());\n  }\n\n  public removeAllFavorites(): boolean {\n    this.singleFavs.clear();\n    this.groupFavs.clear();\n    this.saveFavorites();\n    return true;\n  }\n\n  public changeLabel(favorite: Favorite, label: string) {\n    favorite.label = label;\n    if (isSingleFavorite(favorite)) { this.singleFavs.set(favorite.id, favorite); }\n    if (isGroupFavorite(favorite)) { this.groupFavs.set(favorite.id, favorite); }\n    this.saveFavorites();\n  }\n\n  private saveFavorites(): void {\n    this.localStorage.save(CACHE_PARAM_FAVORITES_SINGLE, this.getFavorites());\n    this.localStorage.save(CACHE_PARAM_FAVORITES_GROUP, this.getFavoriteGroups());\n  }\n\n  private loadFavorites(): void {\n    this.singleFavs = new Map();\n    this.groupFavs = new Map();\n    const loadedSingleFavs = this.localStorage.loadArray<SingleFavorite>(CACHE_PARAM_FAVORITES_SINGLE);\n    if (loadedSingleFavs) {\n      loadedSingleFavs.forEach((entry) => this.singleFavs.set(entry.id, entry));\n    }\n    const loadedGroupFavs = this.localStorage.loadArray<GroupFavorite>(CACHE_PARAM_FAVORITES_GROUP);\n    if (loadedGroupFavs) {\n      loadedGroupFavs.forEach((entry) => this.groupFavs.set(entry.id, entry));\n    }\n  }\n}\n\nexport interface Favorite {\n  id: string;\n  label: string;\n}\n\nexport interface SingleFavorite extends Favorite {\n  favorite: IDataset;\n}\n\nfunction isSingleFavorite(object: any): object is SingleFavorite {\n  return 'favorite' in object;\n}\n\nexport interface GroupFavorite extends Favorite {\n  favorites: IDataset[];\n}\n\nfunction isGroupFavorite(object: any): object is GroupFavorite {\n  return 'favorites' in object;\n}\n","import { Component, Input, OnChanges, SimpleChanges } from '@angular/core';\nimport { IDataset, NotifierService } from '@helgoland/core';\nimport { TranslateService } from '@ngx-translate/core';\n\nimport { FavoriteService } from '../service/favorite.service';\n\n@Component({\n  selector: 'n52-favorite-toggler',\n  template: `<i class=\"fa\" (click)=\"toggle(); $event.stopPropagation();\" [ngClass]=\"isFavorite ? 'fa-star' : 'fa-star-o'\"></i>`\n})\nexport class FavoriteTogglerComponent implements OnChanges {\n\n  @Input()\n  public dataset: IDataset;\n  public isFavorite: boolean;\n\n  constructor(\n    protected favSrvc: FavoriteService,\n    protected notifier: NotifierService,\n    protected translate: TranslateService\n  ) { }\n\n  public ngOnChanges(changes: SimpleChanges): void {\n    if (changes.dataset && this.dataset) {\n      this.isFavorite = this.favSrvc.hasFavorite(this.dataset);\n    }\n  }\n\n  public toggle() {\n    if (this.isFavorite) {\n      this.isFavorite = false;\n      this.favSrvc.removeFavorite(this.dataset.internalId);\n      this.translate.get('favorite.notifier.remove-favorite').subscribe((translation) => {\n        this.notifier.notify(translation + ': ' + this.dataset.label);\n      });\n    } else {\n      this.isFavorite = true;\n      this.favSrvc.addFavorite(this.dataset);\n      this.translate.get('favorite.notifier.add-favorite').subscribe((translation) => {\n        this.notifier.notify(translation + ': ' + this.dataset.label);\n      });\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs/Observable';\nimport { Observer } from 'rxjs/Observer';\n\nimport { FavoriteService, SingleFavorite } from './favorite.service';\n\n@Injectable()\nexport class JsonFavoriteExporterService {\n\n  constructor(\n    protected favoriteSrvc: FavoriteService\n  ) { }\n\n  public exportFavorites() {\n    const filename = 'favorites.json';\n    const json = JSON.stringify(this.favoriteSrvc.getFavorites());\n    // if (window.navigator.msSaveBlob) {\n    //     // IE version >= 10\n    //     const blob = new Blob([json], {\n    //         type: 'application/json;charset=utf-8;'\n    //     });\n    //     window.navigator.msSaveBlob(blob, filename);\n    // } else {\n    // FF, Chrome ...\n    const a = document.createElement('a');\n    a.href = 'data:application/json,' + encodeURIComponent(json);\n    a.target = '_blank';\n    a.download = filename;\n    document.body.appendChild(a);\n    a.click();\n    // }\n  }\n\n  public importFavorites(event: any): Observable<boolean> {\n    return new Observable<boolean>((observer: Observer<boolean>) => {\n      const files = event.target.files;\n      if (files && files.length > 0) {\n        this.favoriteSrvc.removeAllFavorites();\n        const reader = new FileReader();\n        reader.readAsText(files[0]);\n        reader.onerror = () => {\n          // alertService.error($translate.instant('favorite.import.wrongFile'));\n        };\n        reader.onload = (e: any) => {\n          const result = e.target.result;\n          const favorites = JSON.parse(result) as SingleFavorite[];\n          favorites.forEach((entry) => {\n            this.favoriteSrvc.addFavorite(entry.favorite, entry.label);\n          });\n          observer.next(true);\n          observer.complete();\n        };\n      }\n    });\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\n\nimport { FavoriteTogglerComponent } from './favorite-toggler/favorite-toggler.component';\nimport { FavoriteService } from './service/favorite.service';\nimport { JsonFavoriteExporterService } from './service/json-favorite-exporter.service';\n\nconst COMPONENTS = [\n  FavoriteTogglerComponent\n];\n\n@NgModule({\n  declarations: [\n    COMPONENTS\n  ],\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    COMPONENTS\n  ],\n  providers: [\n    FavoriteService,\n    JsonFavoriteExporterService\n  ]\n})\nexport class HelgolandFavoriteModule { }\n"],"names":[],"mappings":"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"}
